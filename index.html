<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Maritime Hub</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet">
<link href="https://api.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.css" rel="stylesheet">
<script src="https://api.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.js"></script>
<script src="https://api.windy.com/assets/map-forecast/libBoot.js"></script>

<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  :root {
    --accident: #1a6fb5;
    --news: #ea7317;
    --event: #2d9f6b;
  }
  body { font-family: 'Inter', sans-serif; overflow: hidden; }

  /* ‚ïê‚ïê‚ïê TOP BAR ‚ïê‚ïê‚ïê */
  .top-bar {
    position: fixed; top: 0; left: 0; right: 0; height: 40px;
    background: rgba(22,28,36,0.95); backdrop-filter: blur(10px);
    border-bottom: 1px solid rgba(255,255,255,0.1);
    display: flex; align-items: center; padding: 0 16px; z-index: 1000;
  }
  .logo {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 12px; font-weight: 500; color: #fff;
  }
  .logo-sub {
    font-size: 9px; color: rgba(255,255,255,0.5); margin-left: 6px;
  }
  .legend {
    margin-left: auto; display: flex; gap: 12px;
  }
  .legend-item {
    display: flex; align-items: center; gap: 5px;
    font-size: 10px; color: rgba(255,255,255,0.7);
  }
  .legend-dot { width: 6px; height: 6px; border-radius: 50%; }

  /* ‚ïê‚ïê‚ïê CALENDAR BAR ‚ïê‚ïê‚ïê */
  .calendar-bar {
    position: fixed; top: 40px; left: 0; right: 0;
    max-height: 12vh;
    background: rgba(22,28,36,0.92); backdrop-filter: blur(8px);
    border-bottom: 1px solid rgba(255,255,255,0.1);
    z-index: 999; padding: 8px 16px;
    display: flex; align-items: center; gap: 12px;
  }
  .month-selector {
    display: flex; align-items: center; gap: 6px;
    padding: 4px 8px; background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.1); border-radius: 4px;
  }
  .year-label {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 11px; color: rgba(255,255,255,0.5); margin-right: 4px;
  }
  .month-btn {
    width: 24px; height: 24px; border: none;
    background: rgba(255,255,255,0.08); border-radius: 3px;
    color: rgba(255,255,255,0.7); cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    font-size: 12px; transition: all 0.15s;
  }
  .month-btn:hover { background: rgba(255,255,255,0.15); color: #fff; }
  .month-name {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 12px; font-weight: 500; color: #fff;
    min-width: 60px; text-align: center;
  }
  .days-strip {
    flex: 1; display: flex; gap: 3px; overflow-x: auto; padding: 2px 0;
  }
  .days-strip::-webkit-scrollbar { height: 2px; }
  .days-strip::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 1px; }
  .day-item {
    min-width: 44px; display: flex; flex-direction: column;
    align-items: center; padding: 4px 3px 3px;
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 4px; cursor: pointer; transition: all 0.15s;
  }
  .day-item:hover { background: rgba(255,255,255,0.1); }
  .day-item.active { background: rgba(255,255,255,0.15); border-color: rgba(255,255,255,0.3); }
  .day-num {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 11px; font-weight: 500; color: rgba(255,255,255,0.9);
    margin-bottom: 3px;
  }
  .day-events { display: flex; flex-direction: column; gap: 2px; width: 100%; }
  .event-bar { height: 2px; border-radius: 1px; }
  .bar-accident { background: var(--accident); }
  .bar-news { background: var(--news); }
  .bar-event { background: var(--event); }

  /* ‚ïê‚ïê‚ïê MAP ‚ïê‚ïê‚ïê */
  #map {
    position: fixed; top: 0; left: 0;
    width: 100%; height: 100vh; z-index: 1;
  }

  /* ‚ïê‚ïê‚ïê MAP CONTROLS ‚ïê‚ïê‚ïê */
  .map-controls {
    position: fixed; top: 120px; right: 10px; z-index: 998;
    display: flex; flex-direction: column; gap: 6px;
  }
  .control-btn {
    width: 34px; height: 34px;
    background: rgba(22,28,36,0.95); backdrop-filter: blur(8px);
    border: 1px solid rgba(255,255,255,0.15);
    border-radius: 4px; cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    font-size: 16px; transition: all 0.15s;
    box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    color: rgba(255,255,255,0.8);
  }
  .control-btn:hover {
    background: rgba(30,40,50,1);
    border-color: rgba(255,255,255,0.3);
    color: #fff;
  }
  .control-btn.active {
    background: rgba(255,255,255,0.15);
    border-color: rgba(255,255,255,0.4);
    color: #fff;
  }

  /* ‚ïê‚ïê‚ïê WEATHER LEGEND ‚ïê‚ïê‚ïê */
  .weather-legend {
    position: fixed; bottom: 50px; left: 10px; z-index: 998;
    background: rgba(22,28,36,0.95); backdrop-filter: blur(8px);
    border: 1px solid rgba(255,255,255,0.15);
    border-radius: 6px; padding: 10px 12px;
    min-width: 140px; max-width: 200px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.3);
  }
  .legend-header {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 10px; font-weight: 500;
    color: rgba(255,255,255,0.6);
    margin-bottom: 8px; text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  #legend-content {
    font-size: 10px; color: rgba(255,255,255,0.8);
    line-height: 1.6;
  }
  .legend-row {
    display: flex; align-items: center; gap: 6px; margin: 4px 0;
  }
  .legend-color {
    width: 20px; height: 12px; border-radius: 2px;
  }

  /* ‚ïê‚ïê‚ïê SIDE PANEL ‚ïê‚ïê‚ïê */
  .side-panel {
    position: fixed; top: 40px; right: 0;
    width: 360px; height: calc(100vh - 40px);
    background: rgba(22,28,36,0.98); backdrop-filter: blur(12px);
    border-left: 1px solid rgba(255,255,255,0.1);
    box-shadow: -4px 0 16px rgba(0,0,0,0.3);
    z-index: 997; transform: translateX(100%); transition: transform 0.3s;
    display: flex; flex-direction: column;
  }
  .side-panel.open { transform: translateX(0); }
  .panel-header {
    padding: 14px 16px;
    border-bottom: 1px solid rgba(255,255,255,0.1);
    display: flex; align-items: center; justify-content: space-between;
  }
  .panel-title {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 11px; color: rgba(255,255,255,0.6);
  }
  .close-panel {
    background: none; border: none;
    font-size: 18px; cursor: pointer;
    color: rgba(255,255,255,0.6);
    padding: 4px; transition: color 0.15s;
  }
  .close-panel:hover { color: #fff; }
  .panel-content {
    flex: 1; overflow-y: auto; padding: 12px 16px;
  }
  .event-card {
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 6px; padding: 12px;
    margin-bottom: 10px; cursor: pointer; transition: all 0.15s;
  }
  .event-card:hover {
    background: rgba(255,255,255,0.08);
    border-color: rgba(255,255,255,0.2);
  }
  .event-type-badge {
    display: inline-block; font-size: 9px; font-weight: 600;
    letter-spacing: 0.5px; padding: 3px 6px; border-radius: 3px;
    text-transform: uppercase; margin-bottom: 6px;
  }
  .badge-accident { background: rgba(26,111,181,0.2); color: #7ab8f5; }
  .badge-news { background: rgba(234,115,23,0.2); color: #ffb380; }
  .badge-event { background: rgba(45,159,107,0.2); color: #6dd4a7; }
  .event-title {
    font-size: 12px; font-weight: 500; color: rgba(255,255,255,0.95);
    line-height: 1.4; margin-bottom: 4px;
  }
  .event-source { font-size: 10px; color: rgba(255,255,255,0.5); }

  /* ‚ïê‚ïê‚ïê DETAIL MODAL ‚ïê‚ïê‚ïê */
  .detail-modal {
    position: fixed; inset: 0;
    background: rgba(0,0,0,0.7); z-index: 9999;
    display: none; align-items: center; justify-content: center; padding: 40px;
  }
  .detail-modal.open { display: flex; }
  .modal-content {
    background: rgba(22,28,36,1);
    border: 1px solid rgba(255,255,255,0.15);
    border-radius: 8px; max-width: 700px; width: 100%;
    max-height: 85vh; overflow-y: auto;
    box-shadow: 0 20px 60px rgba(0,0,0,0.5);
  }
  .modal-header {
    padding: 16px 20px;
    border-bottom: 1px solid rgba(255,255,255,0.1);
    display: flex; align-items: center; justify-content: space-between;
  }
  .modal-close {
    background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.15);
    padding: 6px 12px; border-radius: 4px; cursor: pointer;
    font-size: 11px; color: rgba(255,255,255,0.7); transition: all 0.15s;
  }
  .modal-close:hover {
    background: rgba(255,255,255,0.15); color: #fff;
  }
  .modal-body { padding: 20px; }
  .modal-source {
    font-size: 11px; color: rgba(255,255,255,0.5); margin-bottom: 6px;
  }
  .modal-title {
    font-size: 16px; font-weight: 600; color: rgba(255,255,255,0.95);
    line-height: 1.4; margin-bottom: 14px;
  }
  .modal-text {
    font-size: 13px; color: rgba(255,255,255,0.75); line-height: 1.75;
  }
  .modal-text p { margin-bottom: 10px; }
  .modal-footer {
    padding: 12px 20px;
    border-top: 1px solid rgba(255,255,255,0.1);
    display: flex; gap: 6px; flex-wrap: wrap;
  }
  .modal-link {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 10px; color: #7ab8f5;
    text-decoration: none;
    border: 1px solid rgba(122,184,245,0.3);
    padding: 5px 10px; border-radius: 4px; transition: all 0.15s;
  }
  .modal-link:hover {
    background: rgba(122,184,245,0.15);
    border-color: rgba(122,184,245,0.5);
  }
  .modal-tag {
    font-size: 9px; background: rgba(255,255,255,0.05);
    color: rgba(255,255,255,0.5);
    padding: 4px 8px; border-radius: 3px;
    font-family: 'IBM Plex Mono', monospace;
  }

  @media (max-width: 768px) {
    .side-panel { width: 100%; }
    .legend { display: none; }
    .year-label { display: none; }
    .month-name { min-width: 50px; font-size: 11px; }
  }
</style>
</head>
<body>

<!-- TOP BAR -->
<div class="top-bar">
  <div class="logo">
    Maritime Hub
    <span class="logo-sub">powered by autonomousship.org</span>
  </div>
  <div class="legend">
    <div class="legend-item">
      <div class="legend-dot" style="background:var(--accident)"></div>Accident
    </div>
    <div class="legend-item">
      <div class="legend-dot" style="background:var(--news)"></div>News
    </div>
    <div class="legend-item">
      <div class="legend-dot" style="background:var(--event)"></div>Event
    </div>
  </div>
</div>

<!-- CALENDAR BAR -->
<div class="calendar-bar">
  <div class="month-selector">
    <span class="year-label">2026</span>
    <button class="month-btn" onclick="changeMonth(-1)">‚óÄ</button>
    <div class="month-name" id="month-name"></div>
    <button class="month-btn" onclick="changeMonth(1)">‚ñ∂</button>
  </div>
  <div class="days-strip" id="days-strip"></div>
</div>

<div id="year-label">2026</div>

<!-- MAP -->
<div id="map"></div>

<!-- MAP CONTROLS -->
<div class="map-controls">
  <button class="control-btn" onclick="toggleProjection()" title="Globe / Flat View">üåê</button>
  <button class="control-btn" onclick="cycleStyle()" title="Change Map Style">üó∫Ô∏è</button>
  <button class="control-btn" onclick="toggle3D()" title="3D View">üìê</button>
  <div style="height: 1px; background: rgba(255,255,255,0.1); margin: 4px 0;"></div>
  <button class="control-btn" id="layer-wind" onclick="toggleWeatherLayer('wind')" title="Wind Speed/Direction">üí®</button>
  <button class="control-btn" id="layer-wave" onclick="toggleWeatherLayer('wave')" title="Wave Height">üåä</button>
  <button class="control-btn" id="layer-temp" onclick="toggleWeatherLayer('temp')" title="Sea Surface Temp">üå°Ô∏è</button>
  <button class="control-btn" id="layer-current" onclick="toggleWeatherLayer('current')" title="Ocean Currents">üåÄ</button>
  <div style="height: 1px; background: rgba(255,255,255,0.1); margin: 4px 0;"></div>
  <button class="control-btn active" id="filter-accident" onclick="toggleFilter('accident')" title="Toggle Accidents">‚ö†Ô∏è</button>
  <button class="control-btn active" id="filter-event" onclick="toggleFilter('event')" title="Toggle Events">üìÖ</button>
</div>

<!-- WEATHER LEGEND -->
<div class="weather-legend" id="weather-legend" style="display:none;">
  <div class="legend-header">Weather Layers</div>
  <div id="legend-content"></div>
</div>

<!-- SIDE PANEL -->
<div class="side-panel" id="side-panel">
  <div class="panel-header">
    <div class="panel-title" id="panel-title"></div>
    <button class="close-panel" onclick="closePanel()">‚úï</button>
  </div>
  <div class="panel-content" id="panel-content"></div>
</div>

<!-- DETAIL MODAL -->
<div class="detail-modal" id="detail-modal" onclick="closeIfOverlay(event)">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-source" id="modal-source"></div>
      <button class="modal-close" onclick="closeDetail()">‚úï Close</button>
    </div>
    <div class="modal-body">
      <div class="modal-title" id="modal-title"></div>
      <div class="modal-text" id="modal-text"></div>
    </div>
    <div class="modal-footer" id="modal-footer"></div>
  </div>
</div>

<script src="data.js"></script>
<script src="app.js"></script>
</body>
</html>
